# 递归

## Promise
```typescript

// 获取深层Promise的返回值类型
type DeepPromise = Promise<Promise<Promise<Promise<Promise<Record<string, any>>>>>>
type GetDeepPromiseReturnType<T extends Promise<unknown>>
    = T extends Promise<infer PromiseReturnType>
        ? PromiseReturnType extends Promise<unknown>
            ? GetDeepPromiseReturnType<PromiseReturnType>
            : PromiseReturnType
        : T

type DeepPromiseReturnType = GetDeepPromiseReturnType<DeepPromise>
/*
    type DeepPromiseReturnType = {
        [x: string]: any;
    }
*/


// 简化
type GetDeepPromiseReturnType2<T>
    = T extends Promise<infer ReturnType>
        ? GetDeepPromiseReturnType2<ReturnType>
        : T
type DeepPromiseReturnType2 = GetDeepPromiseReturnType2<DeepPromise>
/*
    type DeepPromiseReturnType2 = {
        [x: string]: any;
    }
*/
// 因为不对T约束，所以可以传其他类型的值了
type DeepPromiseReturnType3 = GetDeepPromiseReturnType2<number>
// type DeepPromiseReturnType3 = number

```

## 数组/元组

```typescript

// 元组反转
type Tuple = [1,2,3,4,5,6]
type ReverseTuple<Tuple extends unknown[]>
    = Tuple extends [...infer Rest, infer LastType]
        ? [LastType, ...ReverseTuple<Rest>]
        : Tuple
type ReverseTupleResult = ReverseTuple<Tuple>
// type ReverseTupleResult = [6, 5, 4, 3, 2, 1]


// 查找元组内是否存在某个类型
type Tuple2 = [string, number[], 1]
type HasType<Tuple extends unknown[], TargetType>
    = Tuple extends [infer CheckType, ...infer RestType]
        ? IsEqual<CheckType, TargetType> extends true
            ? true
            : HasType<RestType, TargetType>
        : false
type IsEqual<A, B> = A extends B
    ? B extends A
        ? true
        : false
    : false
type HasTypeResult1 = HasType<Tuple2, number>     // false
type HasTypeResult2 = HasType<Tuple2, number[]>   // true
type HasTypeResult3 = HasType<Tuple2, boolean>    // false
type HasTypeResult4 = HasType<Tuple2, 1>          // true


// 移除元组内某个类型
type RemoveTypeFromTuple<
    T extends unknown[],
    TargetType,
    ResultTuple extends unknown[] = []
>
    = T extends [infer CheckType, ...infer RestType]
        ? IsEqual<CheckType, TargetType> extends true
            ? RemoveTypeFromTuple<RestType, TargetType, ResultTuple>
            : RemoveTypeFromTuple<RestType, TargetType, [ ...ResultTuple, CheckType ]>
        : ResultTuple
type RemoveTypeFromTupleResult = RemoveTypeFromTuple<[1,number,2,string,3,number,4], number>


// 构造一个指定数量的元组
type CreateTuple<
    amount extends number,
    PushType = unknown,
    Result extends unknown[] = []
> = Result['length'] extends amount
    ? Result
    : CreateTuple<amount, PushType, [...Result, PushType]>
type CreateTupleResult1 = CreateTuple<1>          // [unknown]
type CreateTupleResult2 = CreateTuple<2, number>  // [number, number]
type CreateTupleResult3 = CreateTuple<0>          // []

```